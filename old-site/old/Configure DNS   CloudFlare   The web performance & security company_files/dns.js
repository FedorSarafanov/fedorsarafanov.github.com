(function(c){var b=/type-(\w*)/,d={1:"Automatic",300:"5 mins",600:"10 mins",900:"15 mins",1800:"30 mins",3600:"1 hour",7200:"2 hours",18E3:"5 hours",43200:"12 hours",86400:"1 day"},e={zone_name:"",rec_id:"",type:"A",name:"",display_name:"",content:"",display_content:"",prio:"",ttl:"",props:{cloud_on:0,proxiable:!0},srv:{service:"",protocol:"",srvname:"",prio:"",weight:"",port:"",target:""}},j={a:"A",cname:"CNAME",mx:"MX",txt:"TXT",spf:"SPF",aaaa:"AAAA",ns:"NS",srv:"SRV",loc:"LOC"},k={a:"A",cname:"CNAME",
aaaa:"AAAA",txt:"TXT",spf:"SPF"},l={_tcp:"tcp",_udp:"udp",_tls:"tls"};c.widget("ui.dnsRec",c.ui.recordRow,{options:{editable:!0,summarize:!1,cnameHosting:!1,data:null,load:null,nodata:!1,newrec:!1,proxySix:!1,keyControl:!1,onChange:c.noop,onResize:c.noop},_hasTabCapture:function(){return this.options.keyControl},_render:function(){var a=this,f=new c.cf.Query({}),i=function(i){return function(b,d){var h,e,j=c.extend({z:a.options.data&&a.options.data.zone_name,id:a.options.data&&a.options.data.rec_id,
rtag:a.options.data&&a.options.data.rec_tag},b);a._trigger("_before_"+i);a.clearAlert();a._clearActiveBlurCountdown();e=f.withAct(i);e.type="rec/load"===i?"GET":"POST";h=e.withData(j).query(function(){var f=[].slice.apply(arguments);f.push(h);a._trigger("_after_"+i);d.apply(this,f);a._trigger("_change")});a._trigger("_"+i);return h}};a.queries={newRec:i("rec/new"),loadRec:i("rec/load"),editRec:i("rec/edit"),deleteRec:i("rec/delete"),proxyRec:i("rec/route"),dnsHlpr:new c.cf.Query({url:"/ajax/dns-helper2"})};
a.outputHistory=[];if(a.options)return a.onResize=a.options.onResize,a.options.onChange.call||(a.options.onChange=c.noop),a.options.nodata||a.options.newrec?a._renderDnsNoData():a.options.data?a._renderDns():a.options.load?a._loadData(function(f){f?a._renderDnsNoData():a._renderDnsData()}):a._renderDnsNoData(),this.element},_renderDns:function(){var a=this,f=a.getFields();a.preProcess();a.widgetElement.addClass("dns-row "+a.getClassName());c.each(f,function(f,b){a.dataRow.append(a.drawCell(b))});
a.drawInitialAlert();a.drawLoadMoreOverlay();a.drawLoadingOverlay();a.drawSavingOverlay();a.drawDeletingOverlay();a.drawNoDataOverlay();a.drawDeletePane(a.dataRow)},_attachWidgets:function(){var a=this,f=a.widgetElement;f.find(".cell input, .cell select").not(".type-srv-srvname").valid({useTooltip:!1}).each(function(){var i=c(this),b=c(this).closest(".cell");i.bind("invalid",function(){if(!f.hasClass("alerts-active")){var c="This field must be filled out in order to submit this DNS entry.";b&&b.hasClass("name")&&
(c+=" '@' can stand for the root domain");a.drawAlert("error",c,b);a.showAlert()}i.one("valid",function(){a.clearAlert();a.findActiveInputs().areValid({blur:!1,redispatch:!0})})})});a.widgetElement.find(".cell.ttl .auto-only").tooltip();a.widgetElement.find(".cell.controls .gear-menu").popupMenu({selected:c.proxy(a._onMenuSelect,a)})},_renderDnsNoData:function(){this.options.nodata=!0;return this._renderDns()},getEmptyDataset:function(){return e},_loadData:function(a){var f=this;f.queries.loadRec(f.options.load,
function(b){"success"!=b.result?a(b.msg,b):(f.options.data=b.response.rec.obj,a(null,b))})},getFields:function(){return"type alert-icon name value ttl active controls".split(" ")},preProcess:function(){this.options.data=c.extend({},this.getEmptyDataset(),this.options.data)},getClassName:function(){var a=this.options.data.props.cloud_on,f=(this.options.editable?"":"no-")+"editable",b=this.options.summarize?" summarize":"",c=(this.options.nodata?"no-":"")+"data",g=this.options.newrec?" new-rec editing":
"",d=this.options.loading?" loading":"",h=this.options.loadMore?" load-more":"",e="type-"+this.options.data.type.toLowerCase();return f+b+" "+c+g+d+h+" "+e+" "+("cloud-"+(a?"on":"bypass"))+("cloudFlare"in window&&cloudFlare.faq?"":" no-faq")+(this.options.proxySix?"":" no-proxy-six")+(this.options.data.props.proxiable||1===this.options.data.props.cloud_on?"":" no-proxiable")},drawCell:function(a){var f="draw"+a.replace(/^(.)|[^a-z]([a-z])/g,function(a){return a.charAt(a.length-1).toUpperCase()}),
a=c('<div class="cell '+a+'"></div>');this[f](a);return a},drawType:function(a){var f=this.options.data.type,b=this.options.cnameHosting?k:j;a.append('<div class="highlight output type">'+f+'</div><select class="type-picker input type" tabindex="1"></select>');c.cf.buildOptions(a.find("select"),{data:b});a.find("select").val(f)},drawAlertIcon:function(a){a.append('<a class="icon expand-alert" href="javascript:void(0);"></a>')},drawName:function(a){var f=this.options.data.name,b=this.options.data.display_name;
a.addClass("truncatable").append('<span class="value-pane output name">'+b+'</span><span class="edit-pane"><input type="text" class="input name" value="'+f+'" tabindex="1" placeholder="e.g. www" error=""/></span>')},drawValue:function(a){var f=this.options.data,b=f.type,m=c.cf.escapeHTML(f.display_content),g=c.cf.escapeHTML(f.content),d=f.prio,h=f.srv;"SRV"===b&&(h=f.data,h.protocol=h.proto,h.srvname=h.name,h.prio=h.priority);a.append('<span class="value-pane type-a">points to <strong class="output type-a-content">'+
g+'</strong></span><span class="edit-pane type-a">points to <input type="text" class="input hlpr type-a-content" value="'+g+'" tabindex="1" placeholder="e.g. 127.0.0.1" error=""/></span>');a.append('<span class="value-pane type-aaaa truncatable">points to <strong class="output type-aaaa-content abbreviatable">'+g+'</strong></span><span class="edit-pane type-aaaa">points to <input type="text" class="input hlpr type-aaaa-content" value="'+g+'" tabindex="1" placeholder="e.g. ::1" error=""/></span>');
a.append('<span class="value-pane type-cname truncatable">is an alias of <strong class="output type-cname-content abbreviatable">'+m+'</strong></span><span class="edit-pane type-cname">is an alias of <input type="text" class="input hlpr type-cname-content" value="'+g+'" tabindex="1" placeholder="e.g. mydomain.com" error=""/></span>');a.append('<span class="value-pane type-mx truncatable">mail handled by <strong class="output type-mx-content abbreviatable">'+m+'</strong></span><span class="value-pane type-mx">with priority <strong class="output type-mx-prio">'+
d+'</strong></span><span class="edit-pane type-mx"><span class="label">mail handled by </span><input type="text" class="input hlpr type-mx-content tooltip-bottom-margin-right" value="'+g+'" tabindex="1" placeholder="e.g. mydomain.com" error=""/></span><span class="edit-pane type-mx"><span class="label">with priority </span><input type="text" class="input type-mx-prio tooltip-right-margin-top" value="'+d+'" tabindex="1" error=""/></span>');a.append('<span class="value-pane type-ns truncatable">managed by <strong class="output type-ns-content abbreviatable">'+
m+'</strong></span><span class="edit-pane type-ns">managed by <input type="text" class="input hlpr type-ns-content" value="'+g+'" tabindex="1" placeholder="e.g. a.nameserver.com" error=""/></span>');a.append('<span class="value-pane type-srv"><span class="label">Service:</span><strong class="output type-srv-service">'+h.service+'</strong></span><span class="edit-pane type-srv"><span class="label">Service:</span><input type="text" class="input type-srv-service tooltip-right-margin-top" tabindex="1" value="'+
h.service+'" error=""/></span><span class="value-pane type-srv"><span class="label">Protocol:</span><strong class="output type-srv-protocol">'+h.protocol+'</strong></span><span class="edit-pane type-srv"><span class="label">Protocol:</span><select class="input type-srv-protocol tooltip-right-margin-top" tabindex="1" error=""></select></span><span class="value-pane type-srv"><span class="label">Name:</span><strong class="output type-srv-srvname truncatable">'+h.srvname+'</strong></span><span class="edit-pane type-srv"><span class="label">Name:</span><input type="text" class="input type-srv-srvname tooltip-right-margin-top" tabindex="1" value="'+
h.srvname+'" placeholder="@" error=""/></span><span class="value-pane type-srv"><span class="label">Priority:</span><strong class="output type-srv-prio">'+h.prio+'</strong></span><span class="edit-pane type-srv"><span class="label">Priority:</span><input type="text" class="input type-srv-prio tooltip-right-margin-top" tabindex="1" value="'+h.prio+'" error=""/></span><span class="value-pane type-srv"><span class="label">Weight:</span><strong class="output type-srv-weight">'+h.weight+'</strong></span><span class="edit-pane type-srv"><span class="label">Weight:</span><input type="text" class="input type-srv-weight tooltip-right-margin-top" tabindex="1" value="'+
h.weight+'" error=""/></span><span class="value-pane type-srv"><span class="label">Port:</span><strong class="output type-srv-port">'+h.port+'</strong></span><span class="edit-pane type-srv"><span class="label">Port:</span><input type="text" class="input type-srv-port tooltip-right-margin-top" tabindex="1" value="'+h.port+'" error=""/></span><span class="value-pane type-srv"><span class="label">Target:</span><strong class="output type-srv-target truncatable">'+h.target+'</strong></span><span class="edit-pane type-srv"><span class="label">Target:</span><input type="text" class="input type-srv-target" tabindex="1" value="'+
h.target+'" error=""/></span>');a.append('<span class="value-pane type-spf truncatable"><span class="output type-spf-content">'+g+'</span></span><span class="edit-pane type-spf"><textarea class="input type-spf-content" tabindex="1" placeholder="SPF record value">'+g+"</textarea></span>");a.append('<span class="value-pane type-txt truncatable"><span class="output type-txt-content">'+g+'</span></span><span class="edit-pane type-txt"><textarea class="input type-txt-content" tabindex="1" placeholder="Text record value">'+
g+"</textarea></span>");a.append('<span class="value-pane type-loc truncatable"><span class="output type-loc-content">'+g+'</span></span><span class="edit-pane type-loc"><textarea class="input type-loc-content" tabindex="1" placeholder="Loc record value">'+g+"</textarea></span>");c.cf.buildOptions(a.find("select.type-srv-protocol"),{data:l,selected:h.protocol})},drawTtl:function(a){var f=this.options.data.ttl,b=c.extend({},d),m="1"==f?"Automatic":b[f]||this._formatDisplayTTL(f);f&&!b[f]&&(b[f]=this._formatDisplayTTL(f));
a.append('<span class="value-pane output ttl">'+m+"</span>");a.append('<span class="value-pane ttl auto-only" tooltip="TTL managed by CloudFlare">Automatic</span>');a.append('<span class="edit-pane"><select class="input ttl" selected="'+f+'" tabindex="1"></select></span>');c.cf.buildOptions(a.find("select"),{data:b});a.find("select").val(f)},_formatDisplayTTL:function(a){return a%86400?a%3600?a%60?a+" s":a/60+" mins":a/3600+" hrs":a/86400+" hrs"},drawActive:function(a){a.append('<div class="cloud"></div>')},
drawControls:function(a){a.append('<div class="editing-controls"><a class="cancel" href="javascript:void(0);" tabindex="1">Cancel</a><a class="delete" href="javascript:void(0);" tabindex="1">Delete</a><a class="help" href="javascript:cloudFlare.faq(\'en_US\', [\'AddThisRecordInfo\']);" tabindex="1">Help</a><a class="save button mini green" tabindex="1" href="javascript:void(0);"><span class="label">Save</span></a><a class="add button mini green" tabindex="1" href="javascript:void(0);"><span class="label">Add</span></a></div><ul class="gear-menu"><li><a class="edit" href="javascript:void(0);">Edit record</a></li><li class="killer"><a class="delete" href="javascript:void(0);">Delete record</a></li></ul>')},
drawInitialAlert:function(){var a=this.options.data,f=a.name,b=a.display_name,c=a.zone_name,g=a.type;"CNAME"==g&&f==c?this.drawAlert("info",'CNAME Flattening will be applied to this record since root/apex CNAME records are limited by the DNS specification. Learn more about <a href="https://support.cloudflare.com/hc/en-us/articles/200169056-CNAME-Flattening-RFC-compliant-support-for-CNAME-at-the-root" target="_blank"><strong>CNAME Flattening</strong></a>.'):/^(CNAME|A)$/.test(g)&&"*"==b&&!a.props.proxiable?
this.drawAlert("info",'CloudFlare wildcard records are DNS only. For acceleration and protection, add specific records for web traffic, such as www.  <a href="https://support.cloudflare.com/hc/en-us/articles/200168826">Learn more</a>'):"MX"==g&&a.mx&&a.mx.auto?(this.drawAlert("info","We added this MX record pointing to your root because we found no MX records on your domain.  If you don't receive email at addresses that end with <strong>@"+c+"</strong>, you should delete this record."),this.showAlert()):
"direct"==b?(this.drawAlert("info","We added a subdomain that allows you to access your server directly without passing through the CloudFlare network. You should use this domain to access services like SSH, FTP, and Telnet. You can change the default name of the subdomain to something other than <strong>direct</strong> for enhanced security."),this.showAlert()):"ssh"==b?(this.drawAlert("info","We added a SSH subdomain for you that does not pass through the CloudFlare network. If in the past you SSHed directly to <strong>"+
c+"</strong>, now you should SSH to <strong>ssh."+c+"</strong>. You can change the default name of the subdomain to something other than <strong>ssh</strong> for enhanced security."),this.showAlert()):"ftp"==b&&(this.drawAlert("info","We added a FTP subdomain for you that does not pass through the CloudFlare network. If in the past you FTPed directly to <strong>"+c+"</strong>, now you should FTP to <strong>ftp."+c+"</strong>. You can change the default name of the subdomain to something other than <strong>ftp</strong> for enhanced security."),
this.showAlert());this.options.newRec&&this.showAlert()},_getDefaultAlertTarget:function(){return this.options.newrec?this.dataRow.find(".cell.type"):this.dataRow.find(".cell.alert-icon")},drawLoadingOverlay:function(){this.widgetElement.append('<div class="cf-row-overlay loading-overlay waiting"><div class="label">Loading&hellip;</div></div>')},drawLoadMoreOverlay:function(){this.widgetElement.append('<div class="cf-row-overlay load-more-overlay"><div class="label"><a href="javascript:void(0);" class="button mini green"><span class="label">Load more records</span></a></div></div>')},
drawSavingOverlay:function(){this.widgetElement.append('<div class="cf-row-overlay saving-overlay waiting"><div class="label">Verifying&hellip;</div></div>')},drawDeletingOverlay:function(){this.widgetElement.append('<div class="cf-row-overlay deleting-overlay waiting"><div class="label">Deleting&hellip;</div></div>')},drawNoDataOverlay:function(){this.widgetElement.append('<div class="cf-row-overlay no-data-overlay"><div class="label">No data</div></div>')},drawDeletePane:function(a){a.append('<div class="cell delete-pane"><a class="cancel" tabindex="1" href="javascript:void(0);">Cancel</a> <a class="button mini red delete" tabindex="1" href="javascript:void(0);"><span class="label">Delete</span></a></div>')},
_attachHandlers:function(){var a=this,b=a.widgetElement,i=b.find(".cell.controls"),d=b.find(".cell.delete-pane"),g=b.find(".cell.active .cloud"),e=b.find(".type-picker"),h=b.find('input[type="text"], input[type="password"], select, textarea'),j=b.find('input[type="text"].hlpr'),k=b.find(".load-more-overlay .button");i.find(".save").click(function(){a.saveRec();return!1});i.find(".add").click(function(){a.addRec();return!1});h.keypress(function(b){if(13==b.which)return!1==a.options.newrec?a.saveRec():
a.addRec(),!1});i.find(".cancel").click(function(){b.removeClass("editing dirty");a.clearAlert();return!1});i.find(".help").click(function(){cloudFlare&&cloudFlare.faq("en_US",["AddThisRecordInfo"]);return!1});i.find(".delete").click(function(){b.addClass("confirm-delete");return!1});d.find(".delete").click(function(){var i=!1,d=!1;b.addClass("deleting");setTimeout(function(){i=!0;d&&b.addClass("deleted")},1E3);b.hasClass("new-rec")?d=!0:a.queries.deleteRec({},function(g){"success"==g.result?(d=!0,
i&&b.addClass("deleted"),a.options.onChange(),c.cf.trackEvent("DNS Setting","Delete Record",a.options.data.type+": "+a.options.data.display_name)):(b.removeClass("deleting"),c.cf.trackEvent("DNS Setting","Error: Delete Record",a.options.data.type+": "+a.options.data.display_name))});return!1});d.find(".cancel").click(function(){b.removeClass("confirm-delete");a.clearAlert();return!1});g.click(function(){var b=a.widgetElement;b.hasClass("cloud-on")?(b.removeClass("cloud-on"),b.addClass("cloud-bypass"),
a.queries.proxyRec({service_mode:0},function(f){"success"!=f.result?(b.removeClass("cloud-bypass"),b.addClass("cloud-on"),a.drawAlert("error",f.msg),a.showAlert()):c.cf.trackEvent("DNS Setting","Service Mode: Off",a.options.data.type+": "+a.options.data.display_name)})):b.hasClass("cloud-bypass")&&(b.removeClass("cloud-bypass"),b.addClass("cloud-on"),a.queries.proxyRec({service_mode:1},function(f){"success"!=f.result?(b.removeClass("cloud-on"),b.addClass("cloud-bypass"),a.drawAlert("error",f.msg),
a.showAlert()):c.cf.trackEvent("DNS Setting","Service Mode: On",a.options.data.type+": "+a.options.data.display_name)}))});e.bind("change",function(i){i=c(i.target);a.clearAlert();b.replaceClassRegExp("type-\\w*","type-"+i.val());a.findActiveInputs().resetValidation()});h.bind("change",function(a){b.hasClass("new-rec")&&""==c(this).val()?b.removeClass("dirty"):c(a.target).hasClass("hidden-field")||b.addClass("dirty")});j.bind("focus",function(){var b=c(this),f=a.findActiveInputs().filter(".name").val(),
i=a.options.data&&a.options.data.zone_name,d=a.getRowType().toUpperCase();f&&i&&a.queries.dnsHlpr.withData({helper_query:f+"."+i+"/"+d}).query(function(a){a&&a.answer&&(b.autocomplete({delay:0,minLength:0,source:function(b,f){var c=_.filter(a.answer,function(a){return a.type==d}),c=_.map(c,function(a){option={label:a.rdata,value:a.rdata};"MX"==a.type&&(option.value=option.value.split(" ")[1]);return option});f(c)}}),b.autocomplete("search",b.val()==b.attr("placeholder")?"":b.val()))})});k.click(function(){a.element.trigger("loadMore")})},
_onHiddenKeyPress:function(a,b){var c=this.widgetElement,d=c.find(".cell.controls"),g=c.find(".cell.delete-pane"),e=c.hasClass("editing"),h=c.hasClass("new-rec"),c=c.hasClass("confirm-delete"),j=!e&&!h&&!c;switch(b){case 13:case 32:case 69:j&&d.find(".edit").click();break;case 68:j&&d.find(".delete").click();break;case 27:!h&&e&&d.find(".cancel").click(),c&&g.find(".cancel").click()}},_onActiveBlur:function(){var a=this.widgetElement;a.hasClass("new-rec")?a.hasClass("dirty")&&this.addRec():a.hasClass("editing")&&
a.hasClass("dirty")&&this.saveRec()},_onMenuSelect:function(a,b){var c=b.target.attr("class"),d=this.widgetElement;switch(c){case "edit":d.addClass("editing");this.findActiveInputs().first().focus();break;case "delete":d.addClass("confirm-delete"),d.find(".delete-pane a.cancel").first().focus()}},saveRec:function(){var a=this,b=a.widgetElement,d=c.Deferred(),e={type:a.getRowType().toUpperCase(),ttl:b.find(".input.ttl").val()};c.extend(e,a.getWritableView());a.syncOutputs();b.removeClass("editing dirty");
b.addClass("submitting");a.queries.editRec(e,function(g,e){if(!g||"success"!=g.result){var h=g?g:c.parseJSON(e.responseText);a.restoreOutputs();b.removeClass("submitting");b.addClass("editing dirty");b.removeClass("dirty");a.drawAlert("error",h.msg);a.showAlert();d.reject();c.cf.trackEvent("DNS Setting","Error: Edit Record",g.msg)}else a.syncModel(g.response.rec.obj),a.syncOutputs(),b.removeClass("submitting"),d.resolve(),c.cf.trackEvent("DNS Setting","Edit Record",g.response.rec.obj.type+": "+g.response.rec.obj.display_name)});
return d},addRec:function(){var a=this,b=a.widgetElement,d=c.Deferred(),e={type:a.getRowType().toUpperCase(),ttl:b.find(".input.ttl").val()};if(!a.findActiveInputs().areValid())return d.reject();c.extend(e,a.getWritableView());a.syncOutputs();a.options.nodata=!1;a.options.newrec=!1;b.removeClass("no-data new-rec dirty editing");b.addClass("data submitting");a.queries.newRec(e,function(g,e){if(!g||"success"!=g.result){var h=g?g:c.parseJSON(e.responseText);a.restoreOutputs();a.options.nodata=!0;a.options.newrec=
!0;b.removeClass("data submitting");b.addClass("no-data new-rec dirty editing");b.addClass("failed").removeClass("dirty");a.drawAlert("error",h.msg);a.showAlert();d.reject();c.cf.trackEvent("DNS Setting","Error: Add Record",g.msg)}else a.syncModel(g.response.rec.obj),a.syncOutputs(),b.removeClass("submitting"),d.resolve(),c.cf.trackEvent("DNS Setting","Add Record",g.response.rec.obj.type+": "+g.response.rec.obj.display_name)});return d},getRowType:function(){var a=this.widgetElement.attr("class");
return b.test(a)&&b.exec(a)[1]||""},getWritableView:function(){var a=this,b=a.getRowType(),c=a.findActiveInputs(),d={},g=function(b){d[b]=/^(@|\.)$/.test(d[b])?a.options.data.zone_name:d[b]},e=function(a){d[a]=d[a].replace(/((\.[^. ]+){2,})[. ]+$/,"$1")};switch(b){case "mx":d.name=c.filter(".name").val();d.content=c.filter(".type-"+b+"-content").val();d.prio=c.filter(".type-"+b+"-prio").val();g("content");e("content");break;case "srv":d.service=c.filter(".type-"+b+"-service").val();d.protocol=c.filter(".type-"+
b+"-protocol").val();d.srvname=c.filter(".type-"+b+"-srvname").val()||"@";d.prio=c.filter(".type-"+b+"-prio").val();d.weight=c.filter(".type-"+b+"-weight").val();d.port=c.filter(".type-"+b+"-port").val();d.target=c.filter(".type-"+b+"-target").val();g("target");e("target");break;case "cname":d.name=c.filter(".name").val();d.content=c.filter(".type-"+b+"-content").val();g("content");e("content");break;default:d.name=c.filter(".name").val(),d.content=c.filter(".type-"+b+"-content").val()}g("name");
return d},findActiveInputs:function(){var a=this.widgetElement,b=this.getRowType(),c=a.hasClass("editing"),d=a.hasClass("new-rec"),g=[];c&&("srv"!==b&&g.push(".cell.name .input"),g.push(".cell.value .edit-pane.type-"+b+" .input"),d&&g.push(".cell.type select.type-picker"),a.hasClass(".cloud-on")||g.push(".cell.ttl select.ttl"));return a.find(g.join(", "))},findActiveOutputs:function(){var a=this.widgetElement,b=this.getRowType(),c=[];"srv"!==b&&c.push(".cell.name");c.push(".cell.value .value-pane.type-"+
b);c.push(".cell.ttl");return a.find(c.join(", ")).find(".output")},_setOutputState:function(a){var b=this.widgetElement;c.each(a,function(a,c){b.find(".output."+a).text(c)});this.drawInitialAlert();this.widgetElement.find(".truncated").removeClass("truncated");this.widgetElement.find(".abbreviated").removeClass("abbreviated").removeAttr("title")},syncOutputs:function(){var a=this.widgetElement,b=this.getRowType(),e=a.find(".input.ttl").val(),j;this.backupOutputs();j={type:b.toUpperCase(),name:a.find(".input.name").val(),
ttl:d[e]||e};a.find(".edit-pane.type-"+b+" .input").each(function(a,d){var e=c(d),i=e.attr("class"),k=RegExp("type-"+b+"-\\w*"),i=k.test(i)&&k.exec(i)[0]||"confused";j[i]=e.val()});this._setOutputState(j)},backupOutputs:function(){var a=this.widgetElement,b=this.getRowType(),d={type:b.toUpperCase(),name:a.find(".output.name").text(),ttl:a.find(".output.ttl").text()};a.find(".value-pane.type-"+b+" .output").each(function(a,e){var j=c(e),h=j.attr("class"),k=RegExp("type-"+b+"-\\w*"),h=k.test(h)&&k.exec(h)[0]||
"confused";d[h]=j.text()});this.outputHistory.push(d)},restoreOutputs:function(){this.outputHistory.length&&this._setOutputState(this.outputHistory.pop())},syncModel:function(a){var b=this,d=b.getRowType();a&&(b.options.data=a,b.widgetElement.find(".input.name").val(a.display_name),b.widgetElement.find(".input.type-"+d+"-content").val(a.content),b.widgetElement.attr("class","record-row dns-row "+b.getClassName()),a.srv&&c.each(a.srv,function(a,c){b.widgetElement.find(".input.type-srv-"+a).val(c)}))},
widget:function(){return this.widgetElement},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},_cancel:function(){this.options.complete(!1);this.destroy()},_done:function(){this.options.complete(!0);this.destroy()},_destroy:function(){var a=this;this.widgetElement.empty();setTimeout(function(){a.widgetElement.remove();a=null})}})})(jQuery);
(function(c){c.widget("ui.dnsTable",c.ui.cloudflareWidget,{options:{editable:!0,cnameHosting:!1,proxySix:!1,load:null,pageLimit:15,apiLimit:0,onChange:c.noop,onTableReady:c.noop},_create:function(){if(this.options){var b=this;b._renderFrame();!b.options.data&&b.options.load?(b.zone_name=b.options.load.z,b.drawLoadingRow(),b._loadData(function(c,e){b.clearLoadingRows();c||!e.response.recs.objs?b._renderNoData():b._renderData()})):b.options.data?(b.zone_name=b.options.data.zone_name,b._renderData()):
b._renderNoData();return this.element}},_renderFrame:function(){var b;this.widgetElement=c('<div class="dns-table"><input class="hidden-field" autofocus="autofocus" tabindex="1"/><div class="dns-table-header table-header"></div><ul class="dns-table-body"></ul></div>');b=this.widgetElement.find(".dns-table-header");this.body=this.widgetElement.find(".dns-table-body");c.each(["Type","Name","Value","TTL","Active"],function(c,e){b.append('<div class="cell header header-'+e.toLowerCase()+'"><span>'+e+
"</span></div>")});this.widgetElement.appendTo(this.element);this.enable();return this.widgetElement},_renderData:function(){var b=this,d=b.options.pageLimit;b.preProcess();c.each(b.options.data.recs,function(e,j){if(!j.rendered&&!(0>--d)){var k=c("<li></li>");b.insertRow(k);k.dnsRec({editable:b.options.editable,cnameHosting:b.options.cnameHosting,proxySix:b.options.proxySix,onResize:c.proxy(b.onRecResize,b),keyControl:!0,data:j});k.bind("dnsrec_change",c.proxy(b.onRecChange,b));j.rendered=!0}});
b._getNumRecsUnrendered()?(b.drawLoadingRow(),b.markAutoLoad()):b.options.data.hasMore&&b.drawLoadMoreRow();b.options.editable&&!b.body.children(".dns-row.new-rec").length&&b.addNewRecRow();b.options.onTableReady()},_getNumRecsUnrendered:function(){return c.grep(this.options.data.recs,function(b){return!b.rendered}).length},insertRow:function(b){var c=this.body.children(".dns-row.new-rec");c.length?b.insertBefore(c):b.appendTo(this.body)},preProcess:function(){var b=["A","AAAA","CNAME","TXT","SPF"];
this.options.cnameHosting&&(this.options.data.recs=c.grep(this.options.data.recs,function(d){return-1!=c.inArray(d.type,b)}))},drawLoadingRow:function(){loadingRow=c("<li></li>");this.insertRow(loadingRow);loadingRow.dnsRec({editable:!1,loading:!0})},clearLoadingRows:function(){this.body.children(".dns-row.loading").each(function(){c(this).data("ui-dnsRec").destroy()})},markAutoLoad:function(){var b=this,d=function(){b.autoLoadScrollPoller=setTimeout(function(){var e=c(window).height()+c(window).scrollTop();
b.autoLoadMarkVPos<e?(c.cf.log("scrolled past mark @ "+(c(window).height()+c(window).scrollTop())+"px"),b.onLoadMore()):d()},80)};b.autoLoadScrollPoller&&clearTimeout(b.autoLoadScrollPoller);var e;e=b.body.children(".dns-row");e=(2<e.length?e.eq(-2):e.last()).offset().top;b.autoLoadMarkVPos=e;d();c.cf.log("computed autoload mark vpos @ "+b.autoLoadMarkVPos+"px")},drawLoadMoreRow:function(){this.loadMoreRow=c("<li></li>");this.insertRow(this.loadMoreRow);this.loadMoreRow.dnsRec({editable:!1,loadMore:!0}).bind("loadMore",
c.proxy(this.onLoadMore,this))},onLoadMore:function(){var b=this;b.loadMoreRow&&(b.loadMoreRow.data("ui-dnsRec").destroy(),b.loadMoreRow=null);b._getNumRecsUnrendered()?(b._renderData(),b.clearLoadingRows()):b.options.data.hasMore&&(b.drawLoadingRow(),b._loadData(function(c,e){b.clearLoadingRows();c||!e.response.recs.objs?b.drawLoadMoreRow():b._renderData()}))},addNewRecRow:function(b){var d=this,b=b||"a",e;e=c("<li></li>").appendTo(d.body);e.dnsRec({newrec:!0,cnameHosting:d.options.cnameHosting,
proxySix:d.options.proxySix,onResize:c.proxy(d.onRecResize,d),keyControl:!0,data:{zone_name:d.zone_name,type:b}});e.bind("dnsrec_before_rec/new",function(b){var e=/type-(\S*)/,b=c(b.target).attr("class"),e=e.test(b)&&e.exec(b)[1];d.addNewRecRowIfFailed(e);d.widgetElement.find(".dns-row").last().find(".type select").focus()});e.bind("dnsrec_change",c.proxy(d.onRecChange,d))},addNewRecRowIfFailed:function(b){var c=this.widgetElement.find(".dns-row").last();(c.is(".submitting")||c.is(".new-rec.failed"))&&
this.addNewRecRow(b)},_renderNoData:function(){this.addNewRecRow();this.options.onTableReady()},_loadData:function(b){var d=this.options.data,e=this.options.load,j=new c.cf.Query({act:"rec/load_all"}),d=this.options.data=d||{},e=this.options.load=e||{};this.options.apiLimit&&(e.max=this.options.apiLimit);d.recs||(d.recs=[]);j.withData(this.options.load).query(function(j){if("success"!=j.result)b(j.msg,j);else{var l=j.response;c.extend(d.recs,l.recs.objs);d.hasMore=l.recs.has_more;e.o=(e.o||0)+l.recs.count;
b(null,j)}})},onRecResize:function(){this._getNumRecsUnrendered()&&this.markAutoLoad()},onRecChange:function(){this.options.onChange()},widget:function(){return this.widgetElement},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},_cancel:function(){this.options.complete(!1);this.destroy()},_done:function(){this.options.complete(!0);this.destroy()},_destroy:function(){this.widgetElement.remove()}})})(jQuery);
(function(c){c.widget("ui.dnsAlerts",c.ui.cloudflareWidget,{options:{z:null},_create:function(){this.element.addClass("dns-alerts");this.initQueries();this.onChange();this.attachHandlers()},initQueries:function(){this.queries={check:new c.cf.Query({act:"rec/load_alerts",data:{z:this.options.z}}),hide:new c.cf.Query({act:"zstore/set",data:{z:this.options.z,zsn:"ui"}}),fix:new c.cf.Query({url:"/api_json",data:{act:"fix_rec_alert",z:this.options.z}})}},onChange:function(){var b=this;b.queries.check.query(function(c){c&&
"success"==c.result&&(b.options.data=c.response.alerts.objs,b.render())})},render:function(){var b=0,d=c("<ul></ul>");c.each(this.options.data,function(c,j){j.msg&&!j.ignore&&(d.append('<li class="panel alert warning type-'+c+'" data-type="'+c+'"><div class="controls"><a class="fix button mini green" href="javascript:void(0);"><span class="label">Let\'s fix this</span></a><a class="hide secondary" href="javascript:void(0);">I know, it\'s OK</a></div><div class="msg">'+j.msg+"</div></li>"),b++)});
this.element.html("").replaceClassRegExp("active",b?"active":"").append(d)},attachHandlers:function(){var b=this;b.element.on("click","a.hide",function(){var d=c(this).closest("li").data("type"),e={};e["ignore-"+d]=1;b.queries.hide.withData(e).query(function(d){"success"!=d.result&&c.cf.notify(d.msg,c.cf.noteType.error);b.onChange()})});b.element.on("click","a.fix",function(){})}})})(jQuery);
