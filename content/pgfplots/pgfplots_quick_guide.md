---
layout: post
title:  "Pgfplots: краткое руководство"
date:  2019-01-09T14:38:27+03:00
---
Пакет `pgfplots` представляет собой мощный инструмент, предназначенный для создания научных графиков. Он создан на базе `tikz`, не менее прекрасного пакета, который позволяет создавать векторную графику прямо на латехе.

Если вы сомневаетесь в необходимости использования `pgfplots` или `tikz`, посмотрите на простые графики, созданные с помощью этих пакетов:

![Графики на PgfPlots](https://cdn.sharelatex.com/learn-scripts/images/3/3e/Pgfplots3.png)
<!--more-->

Основная идея pgfplots - упрощение включения графиков в документ. Задача пользователя - задать формулу или данные, а остальным занимается pgfplots. Так, код графиков ([см. пример на overleaf](https://www.overleaf.com/project/5c5ec5b5f7a1fe5bfc146e10)), приведенных выше (без преамбулы) выглядит так:

```latex
% Код первого графика
\begin{tikzpicture}
	\begin{axis}
		\addplot[color=red]{exp(x)};
	\end{axis}
\end{tikzpicture}
```

```latex
% Код второго графика
\begin{tikzpicture}
	\begin{axis}
		\addplot3[surf] {exp(-x^2-y^2)*x};
	\end{axis}
\end{tikzpicture}
```


Заметьте, от пользователя в простейшем случае не потребовалось практически ничего, кроме задания функции и вида её отображения. Разумеется,  можно и  вручную задать пределы построения функции и многое другое.

## Введение в pgfplots. Окружение осей.

Поскольку pgfplots основан на tikz, график должен находиться в окружении tikzpicture. Сам график строится, как это всегда и положено, в каких-то осях (полотно графика с системой координат и заданным масштабом).

Оси задаются окружением `\begin{axis} ... \end{axis}`. У осей могут быть свои параметры:
```latex
\begin{tikzpicture}
	\begin{axis}[
			%axis,          % Обычные оси
			%semilogxaxis,	% По оси x логарифмический масштаб
			%semilogyaxis,  % По оси y логарифмический масштаб
			%loglogaxis,    % По обоим осям логарифмический масштаб
		]
		\addplot[color=red]{ln(x)};
	\end{axis}
\end{tikzpicture}
```
Здесь они закомментированы. Достаточно одного из параметров, причем параметр `axis` используется по умолчанию, и его можно не указывать.

Чтобы добавить график, используется команда 
```latex 
\addplot[color=red]{ln(x)};
``` 
Внутри квадратных скобок могут быть переданы некоторые параметры, например здесь указан цвет линии графика. Квадратные скобки обязательны, если не передано ни одного параметра, нужно оставить между ними пробел. 

Важно, что все команды (эта необходимость тянется из пакета tikz) должны заканчиваться точкой с запятой.

Внутри фигурных скобок размещается функция, задающая график. Математический аппарат pgfplots-а принадлежит пакету более низкого уровня pgf. Математические возможности pgf достаточно велики, и мы рассмотрим только некоторые аспекты составления сложных функций для построения различных графиков.

## 1. Математика в pgfplots

### 1.1. Стандартные операторы

* Без пояснения: `+,-,*,/,^`
* Сравнение: `>,>=,<=,==,!=`
* Оператор факториала: `x!` аналогичен вызову функции `factorial(x)`

Отдельно стоит сказать об условном операторе `x ? y : z`. Он вернет `y`, если `x` истина, и `z`, если ложь. Это можно использовать, например, для построения функций Хевисайда, о чем будет сказано ниже. 

### 1.2. Стандартные функции

* `div(x,y)`  - целочисленное деление
* `mod(x,y)`  - остаток от деления
* `sign(x)` - знак числа

Также ряд функций, не нуждающихся в объяснениях: 
`factorial(x)`,
`sqrt(x)`,
`exp(x)`,
`ln(x)`,
`log10(x)`,
`log2(x)`,
`abs(x)`

### 1.3. Функции округления

* `round(x)` - округлит до ближайшего целого, большего по модулю чем округляемое, числа: 1.5->2, -1.5->-2
* `floor(x)` - округлит х до ближайшего целого числа в большую сторону
* `ceil(x)` - округлит х до ближайшего целого числа в меньшую сторону
* `int(x)` - просто вернет целую часть `x`
* `frac(x)` - вернет дробную часть `x`

### 1.4. Целочисленные функции

* `iseven(x)`, `isodd(x)` - проверяет четность (нечетность) числа, в случае успеха вернет 1, в случае неудачи 1
* `isprime(x)` - проверяет, простое ли число (аналогично вернет 1/0)

### 1.5. Тригонометрические функции

`sin,cos,tan,sec,cosec,cot,asin,acos,atan`

Важно заметить, что все тригонометрические функции принимают на вход число в градусах, а для перевода из радиан в градусы служит функция `deg`, а обратно - `rad`. Это поведение по умолчанию, его можно поменять:

```latex
\pgfkeys{/pgf/trig format=rad|deg}
```

Кроме того, можно использовать радианы и не изменяя поведение по умолчанию -  указать, что аргумент дан в радианах: `cos(pi/2 r) ->0`.


### 1.6. Гиперболические функции

`sinh,cosh,tanh`

### 1.7. Генерация случайных чисел

Присутствует и возможность генерации случайных чисел: вызов `rnd` вернет случайное число от 0 до 1, `rand` от -1 до 1.

Более подробно о функциях и операторах можно почитать в [руководстве по pgf, 1000-1011 страницы](http://mirrors.mi.ras.ru/CTAN/graphics/pgf/base/doc/pgfmanual.pdf).

## 2. Объявление новых функций 
```latex
\begin{tikzpicture}[
	  declare function={
	    myfun(\x,\t) = (\x*\t);
	  }
  ]
	\begin{axis}
		\addplot[color=red, domain=0:4, samples=300]{myfun(x,2)};
	\end{axis}
\end{tikzpicture}
```

Объявляется новая функция для всего рисунка. Все должно быть понятно из примера.

### 2.1. Составление функции Хевисайда. Ступенька произвольной длины

Используя условный оператор, несложно составить функцию Хевисайда:

```latex
1*(x>0 ? 1 : 0)
```

Очевидно, она будет равна множителю перед скобкой при x>0 и нулю в отрицательной области. Из двух функций Хевисайда можно составить и прямоугольный импульс:

```latex
1*(x>0 ? 1 : 0)-1*(x>1 ? 1 : 0)
```

Это прямоугольный импульс, начинающийся от нуля. Однако, можно создать функцию с аргументами высоты, ширины и начала ступеньки:

```latex
\begin{tikzpicture}[
	  declare function={
	    impuls(\h,\w,\b,\x) = \h*((\x>\b ? 1 : 0)-(\x>(\b+\w) ? 1 : 0));
	  }
  ]
	\begin{axis}
		\addplot[color=red, domain=0:4, samples=300]{impuls(2,2,1,x)};
	\end{axis}
\end{tikzpicture}
```

Заметим, что в общем случае, например для построения кусочно-гладких функций, необязательно создавать громоздкую функцию, которая будет включать в себя все остальные с помощью условного оператора.

Если заранее известно, что функция будет без скачков (скачок сам по себе можно построить, но особого смысла нет), то можно воспользоваться тем, что команда `\addplot` имеет параметр области построения графика `domain=start:end` и использовать несколько плотов:

```latex
\begin{tikzpicture}
	\begin{axis}
		\addplot[color=red, domain=0:1, samples=300]{x^2};
		\addplot[color=red, domain=1:4, samples=300]{2*x};
	\end{axis}
\end{tikzpicture}
```
 
`samples` здесь - количество точек графика. График не может строиться абсолютно непрерывно и берется в некотором числе точек, которые соединяются отрезками: чем выше число точек, тем качественнее картинка, но и медленнее её компиляция и отрисовка. Разумно делать это число меньше для медленно меняющихся графиков и много больше для быстро меняющихся, особенно для таких, как в предыдущем примере - со скачком.

По мере чтения руководства читатель может заметить появление новых параметров без объяснения. Предпологается, что они могут быть интуитивно понятны. 

<!-- # Table of contents
1. [Introduction](#introduction)
2. [Some paragraph](#paragraph1)
    1. [Sub paragraph](#subparagraph1)
3. [Another paragraph](#paragraph2)

## This is the introduction <a name="introduction"></a>
Some introduction text, formatted in heading 2 style -->


<!-- ## 

Оговоримся, что речь идет о векторной графике, которая задается кодом непосредственно в файлах `.tex`. Использование векторных редакторов, таких как Inkscape, может быть значительно проще, но не даёт возможности "на лету" изменять при компиляции картинки соответственно изменившися данным, например.

Преимущество использования `pgfplots` по сравнению c известным пакетом векторной графики в латехе - `pstricks`  - возможность работы в pdflatex, в то время как pstricks принуждает использовать конвейер `.tex->.dvi->.ps->.pdf`. 

Также возможно использование GNUPlot, который позволяет достичь хорошего результата. О GNUPlot когда-нибудь на этом сайте появится статья, так как неплохо знать несколько способов получить качественный результат, например, для оформления научных статей, отчетов и проч.



```latex
\begin{tikzpicture}
\begin{axis}
\addplot[color=red]{exp(x)};
\end{axis}
\end{tikzpicture}
%Here ends the furst plot
\hskip 5pt
%Here begins the 3d plot
\begin{tikzpicture}
\begin{axis}
\addplot3[
    surf,
]
{exp(-x^2-y^2)*x};
\end{axis}
\end{tikzpicture}
``` -->